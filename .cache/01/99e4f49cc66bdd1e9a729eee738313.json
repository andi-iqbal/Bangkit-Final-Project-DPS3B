{"id":"lib.js","dependencies":[{"name":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/.babelrc","includedInParent":true,"mtime":1592144127903},{"name":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/package.json","includedInParent":true,"mtime":1592145407351},{"name":"@tensorflow/tfjs","loc":{"line":1,"column":20},"parent":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/lib.js","resolved":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/node_modules/@tensorflow/tfjs/dist/index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.predict = predict;\nexports.resizeImage = resizeImage;\nexports.clearModelMemory = exports.loadModel = exports.IMAGE_SIZE = void 0;\n\nvar tf = _interopRequireWildcard(require(\"@tensorflow/tfjs\"));\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n// import * as tfjsWasm from '@tensorflow/tfjs-backend-wasm';\n// import * as cam from './cam';\n// import jimp from 'jimp';\nconst MODEL_PATH = './model/model.json'; // const MODEL_PATH = 'https://firebasestorage.googleapis.com/v0/b/catch-of-the-day-45cb7.appspot.com/o/model%2Fmodel.json?alt=media';\n\nconst IMAGE_SIZE = 256;\nexports.IMAGE_SIZE = IMAGE_SIZE;\nlet model;\n\nconst loadModel = async () => {\n  // await tf.setBackend('wasm');\n  console.log('loading model....');\n  model = await tf.loadLayersModel(MODEL_PATH, {}); // Warmup the model. This isn't necessary, but makes the first prediction\n  // faster. Call `dispose` to release the WebGL memory allocated for the return\n  // value of `predict`.\n  // model.predict(tf.zeros([1, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n  // Show model layers and summary\n\n  model.summary();\n};\n\nexports.loadModel = loadModel;\n\nconst clearModelMemory = () => {\n  model.predict(tf.zeros([null, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n};\n/**\n * Given an image element, makes a prediction through model returning the\n * probabilities of the top K classes.\n */\n\n\nexports.clearModelMemory = clearModelMemory;\n\nasync function predict(imgElement) {\n  // The first start time includes the time it takes to extract the image\n  // from the HTML and preprocess it, in additon to the predict() call.\n  const startTime1 = performance.now(); // The second start time excludes the extraction and preprocessing and\n  // includes only the predict() call.\n\n  let startTime2;\n  const logits = tf.tidy(() => {\n    // tf.browser.fromPixels() returns a Tensor from an image element.\n    // const img = tf.browser.fromPixels(imgElement, 1);\n    // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n    const normalizationConstant = 1.0 / 255.0; // const normalized = img.toFloat().mul(normalizationConstant);\n\n    let img = tf.browser.fromPixels(imgElement, 3).resizeBilinear([IMAGE_SIZE, IMAGE_SIZE], false).expandDims(0).pad([[1, 1]]).toFloat().mul(normalizationConstant); // const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n    // Reshape to a single-element batch so we can pass it to predict.\n    // const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n    startTime2 = performance.now(); // Make a prediction through model.\n\n    return model.predict(img);\n  }); // Convert logits to probabilities and class names.\n\n  const classes = await logits.data();\n  console.log('Predictions: ', classes);\n  const labelName = classes[0] < 0.5 ? 'NORMAL' : 'PNEUMONIA';\n  const probability = classes[0];\n  const totalTime1 = performance.now() - startTime1;\n  const totalTime2 = performance.now() - startTime2;\n  console.log(`Done in ${Math.floor(totalTime1)} ms ` + `(not including preprocessing: ${Math.floor(totalTime2)} ms)`); // Return the best probability label\n\n  return `${labelName} (${Math.floor(probability * 100)}%)`;\n}\n\nfunction resizeImage(imgElement) {\n  const canvas = document.createElement('canvas');\n  canvas.height = IMAGE_SIZE;\n  canvas.width = IMAGE_SIZE;\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas\n\n  ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);\n  const img = document.createElement('img');\n  img.src = canvas.toDataURL('image/jpeg');\n  ;\n  img.width = IMAGE_SIZE;\n  img.height = IMAGE_SIZE;\n  return img;\n}\n/* export async function gradCamOverlay(imgElement, canvas){\n  // tf.browser.fromPixels() returns a Tensor from an image element.\n  const img = tf.browser.fromPixels(imgElement, 1);\n\n  // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n  const normalizationConstant = 1.0 / 255.0;\n  const normalized = img.toFloat().mul(normalizationConstant);\n\n  const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n  // Reshape to a single-element batch so we can pass it to predict.\n  const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n  // Calculate Grad-CAM heatmap.\n  const xWithCAMOverlay = cam.gradClassActivationMap(model, 1, batched);\n\n  // const imageH = xWithCAMOverlay.shape[1];\n  // const imageW = xWithCAMOverlay.shape[2];\n  // let imageData = xWithCAMOverlay.dataSync();\n\n  const ctx = canvas.getContext('2d');\n  //get the tensor shape\n  const [height, width] = xWithCAMOverlay.shape;\n  //create a buffer array\n  const buffer = new Uint8Array(width * height * 4)\n  //create an Image data var\n  const imageData = new ImageData(width, height);\n  //get the tensor values as data\n  const data = xWithCAMOverlay.dataSync();\n\n  //map the values to the buffer\n  var i = 0;\n  for(var y = 0; y < height; y++) {\n    for(var x = 0; x < width; x++) {\n      var pos = (y * width + x) * 4;      // position in buffer based on x and y\n      buffer[pos  ] = data[i]             // some R value [0, 255]\n      buffer[pos+1] = data[i+1]           // some G value\n      buffer[pos+2] = data[i+2]           // some B value\n      buffer[pos+3] = 255;                // set alpha channel\n      i+=3\n    }\n  }\n\n  let index = 0;\n  for (let i = 0; i < height; ++i) {\n    for (let j = 0; j < width; ++j) {\n      const inIndex = 3 * (i * height + j);\n      buffer.set([Math.floor(data[inIndex])], index++);\n      buffer.set([Math.floor(data[inIndex + 1])], index++);\n      buffer.set([Math.floor(data[inIndex + 2])], index++);\n      buffer.set([255], index++);\n    }\n  }\n\n  //set the buffer to the image data\n  imageData.data.set(buffer)\n\n  //show the image on canvas\n  ctx.putImageData(imageData, 0, 0);\n\n  const imageEl = new Image();\n  imageEl.onload = function() {\n    ctx.drawImage(image, 0, 0);\n  };\n\n  new jimp({data: new Buffer(buffer), width: width, height: height}, function (err, image) {\n    image.getBase64(jimp.AUTO, function(err, data) {  // Add err\n      console.log(data);\n      imageEl.src = data;\n    });\n  });\n\n  // return tf.browser.toPixels(imageData);\n}*/\n\n\nwindow.loadModel = loadModel;\nwindow.clearModelMemory = clearModelMemory;\nwindow.predict = predict;\nwindow.resizeImage = resizeImage;"},"sourceMaps":{"js":{"mappings":[{"generated":{"line":10,"column":0},"source":"lib.js","original":{"line":1,"column":0}},{"generated":{"line":16,"column":0},"source":"lib.js","original":{"line":2,"column":0}},{"generated":{"line":17,"column":0},"source":"lib.js","original":{"line":3,"column":0}},{"generated":{"line":18,"column":0},"source":"lib.js","original":{"line":4,"column":0}},{"generated":{"line":19,"column":0},"source":"lib.js","original":{"line":6,"column":0}},{"name":"MODEL_PATH","generated":{"line":19,"column":6},"source":"lib.js","original":{"line":6,"column":6}},{"generated":{"line":19,"column":16},"source":"lib.js","original":{"line":6,"column":16}},{"generated":{"line":19,"column":19},"source":"lib.js","original":{"line":6,"column":19}},{"generated":{"line":19,"column":39},"source":"lib.js","original":{"line":6,"column":0}},{"generated":{"line":19,"column":41},"source":"lib.js","original":{"line":7,"column":0}},{"generated":{"line":21,"column":0},"source":"lib.js","original":{"line":9,"column":7}},{"name":"IMAGE_SIZE","generated":{"line":21,"column":6},"source":"lib.js","original":{"line":9,"column":13}},{"generated":{"line":21,"column":16},"source":"lib.js","original":{"line":9,"column":23}},{"generated":{"line":21,"column":19},"source":"lib.js","original":{"line":9,"column":26}},{"generated":{"line":21,"column":22},"source":"lib.js","original":{"line":9,"column":7}},{"generated":{"line":23,"column":0},"source":"lib.js","original":{"line":11,"column":0}},{"name":"model","generated":{"line":23,"column":4},"source":"lib.js","original":{"line":11,"column":4}},{"generated":{"line":23,"column":9},"source":"lib.js","original":{"line":11,"column":0}},{"generated":{"line":25,"column":0},"source":"lib.js","original":{"line":12,"column":7}},{"name":"loadModel","generated":{"line":25,"column":6},"source":"lib.js","original":{"line":12,"column":13}},{"generated":{"line":25,"column":15},"source":"lib.js","original":{"line":12,"column":22}},{"generated":{"line":25,"column":18},"source":"lib.js","original":{"line":12,"column":25}},{"generated":{"line":25,"column":30},"source":"lib.js","original":{"line":12,"column":37}},{"generated":{"line":26,"column":0},"source":"lib.js","original":{"line":13,"column":2}},{"name":"console","generated":{"line":27,"column":0},"source":"lib.js","original":{"line":14,"column":2}},{"name":"console","generated":{"line":27,"column":2},"source":"lib.js","original":{"line":14,"column":2}},{"generated":{"line":27,"column":9},"source":"lib.js","original":{"line":14,"column":9}},{"name":"log","generated":{"line":27,"column":10},"source":"lib.js","original":{"line":14,"column":10}},{"generated":{"line":27,"column":13},"source":"lib.js","original":{"line":14,"column":2}},{"generated":{"line":27,"column":14},"source":"lib.js","original":{"line":14,"column":14}},{"generated":{"line":27,"column":33},"source":"lib.js","original":{"line":14,"column":2}},{"name":"model","generated":{"line":28,"column":0},"source":"lib.js","original":{"line":15,"column":2}},{"name":"model","generated":{"line":28,"column":2},"source":"lib.js","original":{"line":15,"column":2}},{"generated":{"line":28,"column":7},"source":"lib.js","original":{"line":15,"column":7}},{"generated":{"line":28,"column":10},"source":"lib.js","original":{"line":15,"column":10}},{"name":"tf","generated":{"line":28,"column":16},"source":"lib.js","original":{"line":15,"column":16}},{"generated":{"line":28,"column":18},"source":"lib.js","original":{"line":15,"column":18}},{"name":"loadLayersModel","generated":{"line":28,"column":19},"source":"lib.js","original":{"line":15,"column":19}},{"generated":{"line":28,"column":34},"source":"lib.js","original":{"line":15,"column":16}},{"name":"MODEL_PATH","generated":{"line":28,"column":35},"source":"lib.js","original":{"line":15,"column":35}},{"generated":{"line":28,"column":45},"source":"lib.js","original":{"line":15,"column":16}},{"generated":{"line":28,"column":47},"source":"lib.js","original":{"line":15,"column":47}},{"generated":{"line":28,"column":49},"source":"lib.js","original":{"line":15,"column":16}},{"generated":{"line":28,"column":50},"source":"lib.js","original":{"line":15,"column":2}},{"generated":{"line":28,"column":51},"source":"lib.js","original":{"line":12,"column":37}},{"generated":{"line":28,"column":52},"source":"lib.js","original":{"line":17,"column":2}},{"generated":{"line":29,"column":0},"source":"lib.js","original":{"line":18,"column":2}},{"generated":{"line":30,"column":0},"source":"lib.js","original":{"line":19,"column":2}},{"generated":{"line":31,"column":0},"source":"lib.js","original":{"line":20,"column":2}},{"generated":{"line":32,"column":0},"source":"lib.js","original":{"line":22,"column":2}},{"name":"model","generated":{"line":34,"column":0},"source":"lib.js","original":{"line":23,"column":2}},{"name":"model","generated":{"line":34,"column":2},"source":"lib.js","original":{"line":23,"column":2}},{"generated":{"line":34,"column":7},"source":"lib.js","original":{"line":23,"column":7}},{"name":"summary","generated":{"line":34,"column":8},"source":"lib.js","original":{"line":23,"column":8}},{"generated":{"line":34,"column":15},"source":"lib.js","original":{"line":23,"column":2}},{"generated":{"line":35,"column":0},"source":"lib.js","original":{"line":24,"column":1}},{"generated":{"line":35,"column":1},"source":"lib.js","original":{"line":12,"column":7}},{"generated":{"line":39,"column":0},"source":"lib.js","original":{"line":26,"column":7}},{"name":"clearModelMemory","generated":{"line":39,"column":6},"source":"lib.js","original":{"line":26,"column":13}},{"generated":{"line":39,"column":22},"source":"lib.js","original":{"line":26,"column":29}},{"generated":{"line":39,"column":25},"source":"lib.js","original":{"line":26,"column":32}},{"generated":{"line":39,"column":31},"source":"lib.js","original":{"line":26,"column":38}},{"name":"model","generated":{"line":40,"column":0},"source":"lib.js","original":{"line":27,"column":2}},{"name":"model","generated":{"line":40,"column":2},"source":"lib.js","original":{"line":27,"column":2}},{"generated":{"line":40,"column":7},"source":"lib.js","original":{"line":27,"column":7}},{"name":"predict","generated":{"line":40,"column":8},"source":"lib.js","original":{"line":27,"column":8}},{"generated":{"line":40,"column":15},"source":"lib.js","original":{"line":27,"column":2}},{"name":"tf","generated":{"line":40,"column":16},"source":"lib.js","original":{"line":27,"column":16}},{"generated":{"line":40,"column":18},"source":"lib.js","original":{"line":27,"column":18}},{"name":"zeros","generated":{"line":40,"column":19},"source":"lib.js","original":{"line":27,"column":19}},{"generated":{"line":40,"column":24},"source":"lib.js","original":{"line":27,"column":16}},{"generated":{"line":40,"column":25},"source":"lib.js","original":{"line":27,"column":25}},{"generated":{"line":40,"column":26},"source":"lib.js","original":{"line":27,"column":26}},{"generated":{"line":40,"column":30},"source":"lib.js","original":{"line":27,"column":25}},{"name":"IMAGE_SIZE","generated":{"line":40,"column":32},"source":"lib.js","original":{"line":27,"column":32}},{"generated":{"line":40,"column":42},"source":"lib.js","original":{"line":27,"column":25}},{"name":"IMAGE_SIZE","generated":{"line":40,"column":44},"source":"lib.js","original":{"line":27,"column":44}},{"generated":{"line":40,"column":54},"source":"lib.js","original":{"line":27,"column":25}},{"generated":{"line":40,"column":56},"source":"lib.js","original":{"line":27,"column":56}},{"generated":{"line":40,"column":57},"source":"lib.js","original":{"line":27,"column":25}},{"generated":{"line":40,"column":58},"source":"lib.js","original":{"line":27,"column":16}},{"generated":{"line":40,"column":59},"source":"lib.js","original":{"line":27,"column":2}},{"name":"dispose","generated":{"line":40,"column":61},"source":"lib.js","original":{"line":27,"column":61}},{"generated":{"line":40,"column":68},"source":"lib.js","original":{"line":27,"column":2}},{"generated":{"line":41,"column":0},"source":"lib.js","original":{"line":28,"column":1}},{"generated":{"line":41,"column":1},"source":"lib.js","original":{"line":26,"column":7}},{"generated":{"line":42,"column":0},"source":"lib.js","original":{"line":30,"column":0}},{"generated":{"line":50,"column":0},"source":"lib.js","original":{"line":34,"column":7}},{"name":"predict","generated":{"line":50,"column":15},"source":"lib.js","original":{"line":34,"column":22}},{"generated":{"line":50,"column":22},"source":"lib.js","original":{"line":34,"column":7}},{"name":"imgElement","generated":{"line":50,"column":23},"source":"lib.js","original":{"line":34,"column":30}},{"generated":{"line":50,"column":33},"source":"lib.js","original":{"line":34,"column":7}},{"generated":{"line":50,"column":35},"source":"lib.js","original":{"line":34,"column":42}},{"generated":{"line":51,"column":0},"source":"lib.js","original":{"line":35,"column":2}},{"generated":{"line":52,"column":0},"source":"lib.js","original":{"line":36,"column":2}},{"generated":{"line":53,"column":0},"source":"lib.js","original":{"line":37,"column":2}},{"name":"startTime1","generated":{"line":53,"column":8},"source":"lib.js","original":{"line":37,"column":8}},{"generated":{"line":53,"column":18},"source":"lib.js","original":{"line":37,"column":18}},{"name":"performance","generated":{"line":53,"column":21},"source":"lib.js","original":{"line":37,"column":21}},{"generated":{"line":53,"column":32},"source":"lib.js","original":{"line":37,"column":32}},{"name":"now","generated":{"line":53,"column":33},"source":"lib.js","original":{"line":37,"column":33}},{"generated":{"line":53,"column":36},"source":"lib.js","original":{"line":37,"column":21}},{"generated":{"line":53,"column":38},"source":"lib.js","original":{"line":37,"column":2}},{"generated":{"line":53,"column":39},"source":"lib.js","original":{"line":34,"column":42}},{"generated":{"line":53,"column":40},"source":"lib.js","original":{"line":38,"column":2}},{"generated":{"line":54,"column":0},"source":"lib.js","original":{"line":39,"column":2}},{"generated":{"line":56,"column":0},"source":"lib.js","original":{"line":40,"column":2}},{"name":"startTime2","generated":{"line":56,"column":6},"source":"lib.js","original":{"line":40,"column":6}},{"generated":{"line":56,"column":16},"source":"lib.js","original":{"line":40,"column":2}},{"generated":{"line":57,"column":0},"source":"lib.js","original":{"line":41,"column":2}},{"name":"logits","generated":{"line":57,"column":8},"source":"lib.js","original":{"line":41,"column":8}},{"generated":{"line":57,"column":14},"source":"lib.js","original":{"line":41,"column":14}},{"name":"tf","generated":{"line":57,"column":17},"source":"lib.js","original":{"line":41,"column":17}},{"generated":{"line":57,"column":19},"source":"lib.js","original":{"line":41,"column":19}},{"name":"tidy","generated":{"line":57,"column":20},"source":"lib.js","original":{"line":41,"column":20}},{"generated":{"line":57,"column":24},"source":"lib.js","original":{"line":41,"column":17}},{"generated":{"line":57,"column":25},"source":"lib.js","original":{"line":41,"column":25}},{"generated":{"line":57,"column":31},"source":"lib.js","original":{"line":41,"column":31}},{"generated":{"line":58,"column":0},"source":"lib.js","original":{"line":42,"column":4}},{"generated":{"line":59,"column":0},"source":"lib.js","original":{"line":43,"column":4}},{"generated":{"line":60,"column":0},"source":"lib.js","original":{"line":45,"column":4}},{"generated":{"line":61,"column":0},"source":"lib.js","original":{"line":46,"column":4}},{"name":"normalizationConstant","generated":{"line":61,"column":10},"source":"lib.js","original":{"line":46,"column":10}},{"generated":{"line":61,"column":31},"source":"lib.js","original":{"line":46,"column":31}},{"generated":{"line":61,"column":34},"source":"lib.js","original":{"line":46,"column":34}},{"generated":{"line":61,"column":40},"source":"lib.js","original":{"line":46,"column":40}},{"generated":{"line":61,"column":45},"source":"lib.js","original":{"line":46,"column":4}},{"generated":{"line":61,"column":46},"source":"lib.js","original":{"line":41,"column":31}},{"generated":{"line":61,"column":47},"source":"lib.js","original":{"line":47,"column":4}},{"generated":{"line":63,"column":0},"source":"lib.js","original":{"line":49,"column":4}},{"name":"img","generated":{"line":63,"column":8},"source":"lib.js","original":{"line":49,"column":8}},{"generated":{"line":63,"column":11},"source":"lib.js","original":{"line":49,"column":11}},{"name":"tf","generated":{"line":63,"column":14},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":16},"source":"lib.js","original":{"line":49,"column":16}},{"name":"browser","generated":{"line":63,"column":17},"source":"lib.js","original":{"line":49,"column":17}},{"generated":{"line":63,"column":24},"source":"lib.js","original":{"line":49,"column":14}},{"name":"fromPixels","generated":{"line":63,"column":25},"source":"lib.js","original":{"line":49,"column":25}},{"generated":{"line":63,"column":35},"source":"lib.js","original":{"line":49,"column":14}},{"name":"imgElement","generated":{"line":63,"column":36},"source":"lib.js","original":{"line":49,"column":36}},{"generated":{"line":63,"column":46},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":48},"source":"lib.js","original":{"line":49,"column":48}},{"generated":{"line":63,"column":49},"source":"lib.js","original":{"line":49,"column":14}},{"name":"resizeBilinear","generated":{"line":63,"column":51},"source":"lib.js","original":{"line":50,"column":7}},{"generated":{"line":63,"column":65},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":66},"source":"lib.js","original":{"line":50,"column":22}},{"name":"IMAGE_SIZE","generated":{"line":63,"column":67},"source":"lib.js","original":{"line":50,"column":23}},{"generated":{"line":63,"column":77},"source":"lib.js","original":{"line":50,"column":22}},{"name":"IMAGE_SIZE","generated":{"line":63,"column":79},"source":"lib.js","original":{"line":50,"column":35}},{"generated":{"line":63,"column":89},"source":"lib.js","original":{"line":50,"column":22}},{"generated":{"line":63,"column":90},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":92},"source":"lib.js","original":{"line":50,"column":48}},{"generated":{"line":63,"column":97},"source":"lib.js","original":{"line":49,"column":14}},{"name":"expandDims","generated":{"line":63,"column":99},"source":"lib.js","original":{"line":51,"column":7}},{"generated":{"line":63,"column":109},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":110},"source":"lib.js","original":{"line":51,"column":18}},{"generated":{"line":63,"column":111},"source":"lib.js","original":{"line":49,"column":14}},{"name":"pad","generated":{"line":63,"column":113},"source":"lib.js","original":{"line":52,"column":7}},{"generated":{"line":63,"column":116},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":117},"source":"lib.js","original":{"line":52,"column":11}},{"generated":{"line":63,"column":118},"source":"lib.js","original":{"line":52,"column":12}},{"generated":{"line":63,"column":119},"source":"lib.js","original":{"line":52,"column":13}},{"generated":{"line":63,"column":120},"source":"lib.js","original":{"line":52,"column":12}},{"generated":{"line":63,"column":122},"source":"lib.js","original":{"line":52,"column":16}},{"generated":{"line":63,"column":123},"source":"lib.js","original":{"line":52,"column":12}},{"generated":{"line":63,"column":124},"source":"lib.js","original":{"line":52,"column":11}},{"generated":{"line":63,"column":125},"source":"lib.js","original":{"line":49,"column":14}},{"name":"toFloat","generated":{"line":63,"column":127},"source":"lib.js","original":{"line":53,"column":7}},{"generated":{"line":63,"column":134},"source":"lib.js","original":{"line":49,"column":14}},{"name":"mul","generated":{"line":63,"column":137},"source":"lib.js","original":{"line":54,"column":7}},{"generated":{"line":63,"column":140},"source":"lib.js","original":{"line":49,"column":14}},{"name":"normalizationConstant","generated":{"line":63,"column":141},"source":"lib.js","original":{"line":54,"column":11}},{"generated":{"line":63,"column":162},"source":"lib.js","original":{"line":49,"column":14}},{"generated":{"line":63,"column":163},"source":"lib.js","original":{"line":49,"column":4}},{"generated":{"line":63,"column":164},"source":"lib.js","original":{"line":41,"column":31}},{"generated":{"line":63,"column":165},"source":"lib.js","original":{"line":56,"column":4}},{"generated":{"line":64,"column":0},"source":"lib.js","original":{"line":58,"column":4}},{"generated":{"line":65,"column":0},"source":"lib.js","original":{"line":59,"column":4}},{"name":"startTime2","generated":{"line":67,"column":0},"source":"lib.js","original":{"line":61,"column":4}},{"name":"startTime2","generated":{"line":67,"column":4},"source":"lib.js","original":{"line":61,"column":4}},{"generated":{"line":67,"column":14},"source":"lib.js","original":{"line":61,"column":14}},{"name":"performance","generated":{"line":67,"column":17},"source":"lib.js","original":{"line":61,"column":17}},{"generated":{"line":67,"column":28},"source":"lib.js","original":{"line":61,"column":28}},{"name":"now","generated":{"line":67,"column":29},"source":"lib.js","original":{"line":61,"column":29}},{"generated":{"line":67,"column":32},"source":"lib.js","original":{"line":61,"column":17}},{"generated":{"line":67,"column":34},"source":"lib.js","original":{"line":61,"column":4}},{"generated":{"line":67,"column":35},"source":"lib.js","original":{"line":41,"column":31}},{"generated":{"line":67,"column":36},"source":"lib.js","original":{"line":63,"column":4}},{"generated":{"line":69,"column":0},"source":"lib.js","original":{"line":64,"column":4}},{"name":"model","generated":{"line":69,"column":11},"source":"lib.js","original":{"line":64,"column":11}},{"generated":{"line":69,"column":16},"source":"lib.js","original":{"line":64,"column":16}},{"name":"predict","generated":{"line":69,"column":17},"source":"lib.js","original":{"line":64,"column":17}},{"generated":{"line":69,"column":24},"source":"lib.js","original":{"line":64,"column":11}},{"name":"img","generated":{"line":69,"column":25},"source":"lib.js","original":{"line":64,"column":25}},{"generated":{"line":69,"column":28},"source":"lib.js","original":{"line":64,"column":11}},{"generated":{"line":69,"column":29},"source":"lib.js","original":{"line":64,"column":4}},{"generated":{"line":70,"column":0},"source":"lib.js","original":{"line":65,"column":3}},{"generated":{"line":70,"column":3},"source":"lib.js","original":{"line":41,"column":17}},{"generated":{"line":70,"column":4},"source":"lib.js","original":{"line":41,"column":2}},{"generated":{"line":70,"column":5},"source":"lib.js","original":{"line":34,"column":42}},{"generated":{"line":70,"column":6},"source":"lib.js","original":{"line":67,"column":2}},{"generated":{"line":72,"column":0},"source":"lib.js","original":{"line":68,"column":2}},{"name":"classes","generated":{"line":72,"column":8},"source":"lib.js","original":{"line":68,"column":8}},{"generated":{"line":72,"column":15},"source":"lib.js","original":{"line":68,"column":15}},{"generated":{"line":72,"column":18},"source":"lib.js","original":{"line":68,"column":18}},{"name":"logits","generated":{"line":72,"column":24},"source":"lib.js","original":{"line":68,"column":24}},{"generated":{"line":72,"column":30},"source":"lib.js","original":{"line":68,"column":30}},{"name":"data","generated":{"line":72,"column":31},"source":"lib.js","original":{"line":68,"column":31}},{"generated":{"line":72,"column":35},"source":"lib.js","original":{"line":68,"column":24}},{"generated":{"line":72,"column":37},"source":"lib.js","original":{"line":68,"column":2}},{"name":"console","generated":{"line":73,"column":0},"source":"lib.js","original":{"line":70,"column":2}},{"name":"console","generated":{"line":73,"column":2},"source":"lib.js","original":{"line":70,"column":2}},{"generated":{"line":73,"column":9},"source":"lib.js","original":{"line":70,"column":9}},{"name":"log","generated":{"line":73,"column":10},"source":"lib.js","original":{"line":70,"column":10}},{"generated":{"line":73,"column":13},"source":"lib.js","original":{"line":70,"column":2}},{"generated":{"line":73,"column":14},"source":"lib.js","original":{"line":70,"column":14}},{"generated":{"line":73,"column":29},"source":"lib.js","original":{"line":70,"column":2}},{"name":"classes","generated":{"line":73,"column":31},"source":"lib.js","original":{"line":70,"column":31}},{"generated":{"line":73,"column":38},"source":"lib.js","original":{"line":70,"column":2}},{"generated":{"line":74,"column":0},"source":"lib.js","original":{"line":71,"column":2}},{"name":"labelName","generated":{"line":74,"column":8},"source":"lib.js","original":{"line":71,"column":8}},{"generated":{"line":74,"column":17},"source":"lib.js","original":{"line":71,"column":17}},{"name":"classes","generated":{"line":74,"column":20},"source":"lib.js","original":{"line":71,"column":20}},{"generated":{"line":74,"column":27},"source":"lib.js","original":{"line":71,"column":27}},{"generated":{"line":74,"column":28},"source":"lib.js","original":{"line":71,"column":28}},{"generated":{"line":74,"column":29},"source":"lib.js","original":{"line":71,"column":27}},{"generated":{"line":74,"column":30},"source":"lib.js","original":{"line":71,"column":20}},{"generated":{"line":74,"column":33},"source":"lib.js","original":{"line":71,"column":33}},{"generated":{"line":74,"column":36},"source":"lib.js","original":{"line":71,"column":20}},{"generated":{"line":74,"column":39},"source":"lib.js","original":{"line":71,"column":38}},{"generated":{"line":74,"column":47},"source":"lib.js","original":{"line":71,"column":20}},{"generated":{"line":74,"column":50},"source":"lib.js","original":{"line":71,"column":49}},{"generated":{"line":74,"column":61},"source":"lib.js","original":{"line":71,"column":2}},{"generated":{"line":75,"column":0},"source":"lib.js","original":{"line":72,"column":2}},{"name":"probability","generated":{"line":75,"column":8},"source":"lib.js","original":{"line":72,"column":8}},{"generated":{"line":75,"column":19},"source":"lib.js","original":{"line":72,"column":19}},{"name":"classes","generated":{"line":75,"column":22},"source":"lib.js","original":{"line":72,"column":22}},{"generated":{"line":75,"column":29},"source":"lib.js","original":{"line":72,"column":29}},{"generated":{"line":75,"column":30},"source":"lib.js","original":{"line":72,"column":30}},{"generated":{"line":75,"column":31},"source":"lib.js","original":{"line":72,"column":29}},{"generated":{"line":75,"column":32},"source":"lib.js","original":{"line":72,"column":2}},{"generated":{"line":76,"column":0},"source":"lib.js","original":{"line":74,"column":2}},{"name":"totalTime1","generated":{"line":76,"column":8},"source":"lib.js","original":{"line":74,"column":8}},{"generated":{"line":76,"column":18},"source":"lib.js","original":{"line":74,"column":18}},{"name":"performance","generated":{"line":76,"column":21},"source":"lib.js","original":{"line":74,"column":21}},{"generated":{"line":76,"column":32},"source":"lib.js","original":{"line":74,"column":32}},{"name":"now","generated":{"line":76,"column":33},"source":"lib.js","original":{"line":74,"column":33}},{"generated":{"line":76,"column":36},"source":"lib.js","original":{"line":74,"column":21}},{"name":"startTime1","generated":{"line":76,"column":41},"source":"lib.js","original":{"line":74,"column":41}},{"generated":{"line":76,"column":51},"source":"lib.js","original":{"line":74,"column":2}},{"generated":{"line":77,"column":0},"source":"lib.js","original":{"line":75,"column":2}},{"name":"totalTime2","generated":{"line":77,"column":8},"source":"lib.js","original":{"line":75,"column":8}},{"generated":{"line":77,"column":18},"source":"lib.js","original":{"line":75,"column":18}},{"name":"performance","generated":{"line":77,"column":21},"source":"lib.js","original":{"line":75,"column":21}},{"generated":{"line":77,"column":32},"source":"lib.js","original":{"line":75,"column":32}},{"name":"now","generated":{"line":77,"column":33},"source":"lib.js","original":{"line":75,"column":33}},{"generated":{"line":77,"column":36},"source":"lib.js","original":{"line":75,"column":21}},{"name":"startTime2","generated":{"line":77,"column":41},"source":"lib.js","original":{"line":75,"column":41}},{"generated":{"line":77,"column":51},"source":"lib.js","original":{"line":75,"column":2}},{"name":"console","generated":{"line":78,"column":0},"source":"lib.js","original":{"line":76,"column":2}},{"name":"console","generated":{"line":78,"column":2},"source":"lib.js","original":{"line":76,"column":2}},{"generated":{"line":78,"column":9},"source":"lib.js","original":{"line":76,"column":9}},{"name":"log","generated":{"line":78,"column":10},"source":"lib.js","original":{"line":76,"column":10}},{"generated":{"line":78,"column":13},"source":"lib.js","original":{"line":76,"column":2}},{"generated":{"line":78,"column":14},"source":"lib.js","original":{"line":76,"column":15}},{"name":"Math","generated":{"line":78,"column":25},"source":"lib.js","original":{"line":76,"column":25}},{"generated":{"line":78,"column":29},"source":"lib.js","original":{"line":76,"column":29}},{"name":"floor","generated":{"line":78,"column":30},"source":"lib.js","original":{"line":76,"column":30}},{"generated":{"line":78,"column":35},"source":"lib.js","original":{"line":76,"column":25}},{"name":"totalTime1","generated":{"line":78,"column":36},"source":"lib.js","original":{"line":76,"column":36}},{"generated":{"line":78,"column":46},"source":"lib.js","original":{"line":76,"column":25}},{"generated":{"line":78,"column":47},"source":"lib.js","original":{"line":76,"column":48}},{"generated":{"line":78,"column":53},"source":"lib.js","original":{"line":76,"column":14}},{"generated":{"line":78,"column":56},"source":"lib.js","original":{"line":77,"column":7}},{"name":"Math","generated":{"line":78,"column":89},"source":"lib.js","original":{"line":77,"column":39}},{"generated":{"line":78,"column":93},"source":"lib.js","original":{"line":77,"column":43}},{"name":"floor","generated":{"line":78,"column":94},"source":"lib.js","original":{"line":77,"column":44}},{"generated":{"line":78,"column":99},"source":"lib.js","original":{"line":77,"column":39}},{"name":"totalTime2","generated":{"line":78,"column":100},"source":"lib.js","original":{"line":77,"column":50}},{"generated":{"line":78,"column":110},"source":"lib.js","original":{"line":77,"column":39}},{"generated":{"line":78,"column":111},"source":"lib.js","original":{"line":77,"column":62}},{"generated":{"line":78,"column":117},"source":"lib.js","original":{"line":76,"column":2}},{"generated":{"line":78,"column":119},"source":"lib.js","original":{"line":34,"column":42}},{"generated":{"line":78,"column":120},"source":"lib.js","original":{"line":79,"column":2}},{"generated":{"line":80,"column":0},"source":"lib.js","original":{"line":80,"column":2}},{"generated":{"line":80,"column":9},"source":"lib.js","original":{"line":80,"column":10}},{"name":"labelName","generated":{"line":80,"column":12},"source":"lib.js","original":{"line":80,"column":12}},{"generated":{"line":80,"column":21},"source":"lib.js","original":{"line":80,"column":22}},{"name":"Math","generated":{"line":80,"column":26},"source":"lib.js","original":{"line":80,"column":26}},{"generated":{"line":80,"column":30},"source":"lib.js","original":{"line":80,"column":30}},{"name":"floor","generated":{"line":80,"column":31},"source":"lib.js","original":{"line":80,"column":31}},{"generated":{"line":80,"column":36},"source":"lib.js","original":{"line":80,"column":26}},{"name":"probability","generated":{"line":80,"column":37},"source":"lib.js","original":{"line":80,"column":37}},{"generated":{"line":80,"column":48},"source":"lib.js","original":{"line":80,"column":48}},{"generated":{"line":80,"column":51},"source":"lib.js","original":{"line":80,"column":51}},{"generated":{"line":80,"column":54},"source":"lib.js","original":{"line":80,"column":26}},{"generated":{"line":80,"column":55},"source":"lib.js","original":{"line":80,"column":56}},{"generated":{"line":80,"column":59},"source":"lib.js","original":{"line":80,"column":2}},{"generated":{"line":81,"column":0},"source":"lib.js","original":{"line":81,"column":1}},{"generated":{"line":83,"column":0},"source":"lib.js","original":{"line":83,"column":7}},{"name":"resizeImage","generated":{"line":83,"column":9},"source":"lib.js","original":{"line":83,"column":16}},{"generated":{"line":83,"column":20},"source":"lib.js","original":{"line":83,"column":7}},{"name":"imgElement","generated":{"line":83,"column":21},"source":"lib.js","original":{"line":83,"column":28}},{"generated":{"line":83,"column":31},"source":"lib.js","original":{"line":83,"column":7}},{"generated":{"line":83,"column":33},"source":"lib.js","original":{"line":83,"column":40}},{"generated":{"line":84,"column":0},"source":"lib.js","original":{"line":84,"column":2}},{"name":"canvas","generated":{"line":84,"column":8},"source":"lib.js","original":{"line":84,"column":8}},{"generated":{"line":84,"column":14},"source":"lib.js","original":{"line":84,"column":14}},{"name":"document","generated":{"line":84,"column":17},"source":"lib.js","original":{"line":84,"column":17}},{"generated":{"line":84,"column":25},"source":"lib.js","original":{"line":84,"column":25}},{"name":"createElement","generated":{"line":84,"column":26},"source":"lib.js","original":{"line":84,"column":26}},{"generated":{"line":84,"column":39},"source":"lib.js","original":{"line":84,"column":17}},{"generated":{"line":84,"column":40},"source":"lib.js","original":{"line":84,"column":40}},{"generated":{"line":84,"column":48},"source":"lib.js","original":{"line":84,"column":17}},{"generated":{"line":84,"column":49},"source":"lib.js","original":{"line":84,"column":2}},{"name":"canvas","generated":{"line":85,"column":0},"source":"lib.js","original":{"line":85,"column":2}},{"name":"canvas","generated":{"line":85,"column":2},"source":"lib.js","original":{"line":85,"column":2}},{"generated":{"line":85,"column":8},"source":"lib.js","original":{"line":85,"column":8}},{"name":"height","generated":{"line":85,"column":9},"source":"lib.js","original":{"line":85,"column":9}},{"generated":{"line":85,"column":15},"source":"lib.js","original":{"line":85,"column":2}},{"name":"IMAGE_SIZE","generated":{"line":85,"column":18},"source":"lib.js","original":{"line":85,"column":16}},{"generated":{"line":85,"column":28},"source":"lib.js","original":{"line":85,"column":2}},{"name":"canvas","generated":{"line":86,"column":0},"source":"lib.js","original":{"line":86,"column":2}},{"name":"canvas","generated":{"line":86,"column":2},"source":"lib.js","original":{"line":86,"column":2}},{"generated":{"line":86,"column":8},"source":"lib.js","original":{"line":86,"column":8}},{"name":"width","generated":{"line":86,"column":9},"source":"lib.js","original":{"line":86,"column":9}},{"generated":{"line":86,"column":14},"source":"lib.js","original":{"line":86,"column":2}},{"name":"IMAGE_SIZE","generated":{"line":86,"column":17},"source":"lib.js","original":{"line":86,"column":15}},{"generated":{"line":86,"column":27},"source":"lib.js","original":{"line":86,"column":2}},{"generated":{"line":87,"column":0},"source":"lib.js","original":{"line":88,"column":2}},{"name":"ctx","generated":{"line":87,"column":8},"source":"lib.js","original":{"line":88,"column":8}},{"generated":{"line":87,"column":11},"source":"lib.js","original":{"line":88,"column":11}},{"name":"canvas","generated":{"line":87,"column":14},"source":"lib.js","original":{"line":88,"column":14}},{"generated":{"line":87,"column":20},"source":"lib.js","original":{"line":88,"column":20}},{"name":"getContext","generated":{"line":87,"column":21},"source":"lib.js","original":{"line":88,"column":21}},{"generated":{"line":87,"column":31},"source":"lib.js","original":{"line":88,"column":14}},{"generated":{"line":87,"column":32},"source":"lib.js","original":{"line":88,"column":32}},{"generated":{"line":87,"column":36},"source":"lib.js","original":{"line":88,"column":14}},{"generated":{"line":87,"column":37},"source":"lib.js","original":{"line":88,"column":2}},{"name":"ctx","generated":{"line":88,"column":0},"source":"lib.js","original":{"line":89,"column":2}},{"name":"ctx","generated":{"line":88,"column":2},"source":"lib.js","original":{"line":89,"column":2}},{"generated":{"line":88,"column":5},"source":"lib.js","original":{"line":89,"column":5}},{"name":"clearRect","generated":{"line":88,"column":6},"source":"lib.js","original":{"line":89,"column":6}},{"generated":{"line":88,"column":15},"source":"lib.js","original":{"line":89,"column":2}},{"generated":{"line":88,"column":16},"source":"lib.js","original":{"line":89,"column":16}},{"generated":{"line":88,"column":17},"source":"lib.js","original":{"line":89,"column":2}},{"generated":{"line":88,"column":19},"source":"lib.js","original":{"line":89,"column":19}},{"generated":{"line":88,"column":20},"source":"lib.js","original":{"line":89,"column":2}},{"name":"canvas","generated":{"line":88,"column":22},"source":"lib.js","original":{"line":89,"column":22}},{"generated":{"line":88,"column":28},"source":"lib.js","original":{"line":89,"column":28}},{"name":"width","generated":{"line":88,"column":29},"source":"lib.js","original":{"line":89,"column":29}},{"generated":{"line":88,"column":34},"source":"lib.js","original":{"line":89,"column":2}},{"name":"canvas","generated":{"line":88,"column":36},"source":"lib.js","original":{"line":89,"column":36}},{"generated":{"line":88,"column":42},"source":"lib.js","original":{"line":89,"column":42}},{"name":"height","generated":{"line":88,"column":43},"source":"lib.js","original":{"line":89,"column":43}},{"generated":{"line":88,"column":49},"source":"lib.js","original":{"line":89,"column":2}},{"generated":{"line":88,"column":51},"source":"lib.js","original":{"line":83,"column":40}},{"generated":{"line":88,"column":52},"source":"lib.js","original":{"line":89,"column":52}},{"name":"ctx","generated":{"line":90,"column":0},"source":"lib.js","original":{"line":90,"column":2}},{"name":"ctx","generated":{"line":90,"column":2},"source":"lib.js","original":{"line":90,"column":2}},{"generated":{"line":90,"column":5},"source":"lib.js","original":{"line":90,"column":5}},{"name":"drawImage","generated":{"line":90,"column":6},"source":"lib.js","original":{"line":90,"column":6}},{"generated":{"line":90,"column":15},"source":"lib.js","original":{"line":90,"column":2}},{"name":"imgElement","generated":{"line":90,"column":16},"source":"lib.js","original":{"line":90,"column":16}},{"generated":{"line":90,"column":26},"source":"lib.js","original":{"line":90,"column":2}},{"generated":{"line":90,"column":28},"source":"lib.js","original":{"line":90,"column":28}},{"generated":{"line":90,"column":29},"source":"lib.js","original":{"line":90,"column":2}},{"generated":{"line":90,"column":31},"source":"lib.js","original":{"line":90,"column":31}},{"generated":{"line":90,"column":32},"source":"lib.js","original":{"line":90,"column":2}},{"name":"canvas","generated":{"line":90,"column":34},"source":"lib.js","original":{"line":90,"column":34}},{"generated":{"line":90,"column":40},"source":"lib.js","original":{"line":90,"column":40}},{"name":"width","generated":{"line":90,"column":41},"source":"lib.js","original":{"line":90,"column":41}},{"generated":{"line":90,"column":46},"source":"lib.js","original":{"line":90,"column":2}},{"name":"canvas","generated":{"line":90,"column":48},"source":"lib.js","original":{"line":90,"column":48}},{"generated":{"line":90,"column":54},"source":"lib.js","original":{"line":90,"column":54}},{"name":"height","generated":{"line":90,"column":55},"source":"lib.js","original":{"line":90,"column":55}},{"generated":{"line":90,"column":61},"source":"lib.js","original":{"line":90,"column":2}},{"generated":{"line":91,"column":0},"source":"lib.js","original":{"line":92,"column":2}},{"name":"img","generated":{"line":91,"column":8},"source":"lib.js","original":{"line":92,"column":8}},{"generated":{"line":91,"column":11},"source":"lib.js","original":{"line":92,"column":11}},{"name":"document","generated":{"line":91,"column":14},"source":"lib.js","original":{"line":92,"column":14}},{"generated":{"line":91,"column":22},"source":"lib.js","original":{"line":92,"column":22}},{"name":"createElement","generated":{"line":91,"column":23},"source":"lib.js","original":{"line":92,"column":23}},{"generated":{"line":91,"column":36},"source":"lib.js","original":{"line":92,"column":14}},{"generated":{"line":91,"column":37},"source":"lib.js","original":{"line":92,"column":37}},{"generated":{"line":91,"column":42},"source":"lib.js","original":{"line":92,"column":14}},{"generated":{"line":91,"column":43},"source":"lib.js","original":{"line":92,"column":2}},{"name":"img","generated":{"line":92,"column":0},"source":"lib.js","original":{"line":93,"column":2}},{"name":"img","generated":{"line":92,"column":2},"source":"lib.js","original":{"line":93,"column":2}},{"generated":{"line":92,"column":5},"source":"lib.js","original":{"line":93,"column":5}},{"name":"src","generated":{"line":92,"column":6},"source":"lib.js","original":{"line":93,"column":6}},{"generated":{"line":92,"column":9},"source":"lib.js","original":{"line":93,"column":2}},{"name":"canvas","generated":{"line":92,"column":12},"source":"lib.js","original":{"line":93,"column":12}},{"generated":{"line":92,"column":18},"source":"lib.js","original":{"line":93,"column":18}},{"name":"toDataURL","generated":{"line":92,"column":19},"source":"lib.js","original":{"line":93,"column":19}},{"generated":{"line":92,"column":28},"source":"lib.js","original":{"line":93,"column":12}},{"generated":{"line":92,"column":29},"source":"lib.js","original":{"line":93,"column":29}},{"generated":{"line":92,"column":41},"source":"lib.js","original":{"line":93,"column":12}},{"generated":{"line":92,"column":42},"source":"lib.js","original":{"line":93,"column":2}},{"generated":{"line":93,"column":0},"source":"lib.js","original":{"line":93,"column":44}},{"name":"img","generated":{"line":94,"column":0},"source":"lib.js","original":{"line":94,"column":2}},{"name":"img","generated":{"line":94,"column":2},"source":"lib.js","original":{"line":94,"column":2}},{"generated":{"line":94,"column":5},"source":"lib.js","original":{"line":94,"column":5}},{"name":"width","generated":{"line":94,"column":6},"source":"lib.js","original":{"line":94,"column":6}},{"generated":{"line":94,"column":11},"source":"lib.js","original":{"line":94,"column":2}},{"name":"IMAGE_SIZE","generated":{"line":94,"column":14},"source":"lib.js","original":{"line":94,"column":14}},{"generated":{"line":94,"column":24},"source":"lib.js","original":{"line":94,"column":2}},{"name":"img","generated":{"line":95,"column":0},"source":"lib.js","original":{"line":95,"column":2}},{"name":"img","generated":{"line":95,"column":2},"source":"lib.js","original":{"line":95,"column":2}},{"generated":{"line":95,"column":5},"source":"lib.js","original":{"line":95,"column":5}},{"name":"height","generated":{"line":95,"column":6},"source":"lib.js","original":{"line":95,"column":6}},{"generated":{"line":95,"column":12},"source":"lib.js","original":{"line":95,"column":2}},{"name":"IMAGE_SIZE","generated":{"line":95,"column":15},"source":"lib.js","original":{"line":95,"column":15}},{"generated":{"line":95,"column":25},"source":"lib.js","original":{"line":95,"column":2}},{"generated":{"line":96,"column":0},"source":"lib.js","original":{"line":97,"column":2}},{"name":"img","generated":{"line":96,"column":9},"source":"lib.js","original":{"line":97,"column":9}},{"generated":{"line":96,"column":12},"source":"lib.js","original":{"line":97,"column":2}},{"generated":{"line":97,"column":0},"source":"lib.js","original":{"line":98,"column":1}},{"generated":{"line":98,"column":0},"source":"lib.js","original":{"line":100,"column":0}},{"name":"window","generated":{"line":173,"column":0},"source":"lib.js","original":{"line":174,"column":0}},{"generated":{"line":173,"column":6},"source":"lib.js","original":{"line":174,"column":6}},{"name":"loadModel","generated":{"line":173,"column":7},"source":"lib.js","original":{"line":174,"column":7}},{"generated":{"line":173,"column":16},"source":"lib.js","original":{"line":174,"column":0}},{"name":"loadModel","generated":{"line":173,"column":19},"source":"lib.js","original":{"line":174,"column":19}},{"generated":{"line":173,"column":28},"source":"lib.js","original":{"line":174,"column":0}},{"name":"window","generated":{"line":174,"column":0},"source":"lib.js","original":{"line":175,"column":0}},{"generated":{"line":174,"column":6},"source":"lib.js","original":{"line":175,"column":6}},{"name":"clearModelMemory","generated":{"line":174,"column":7},"source":"lib.js","original":{"line":175,"column":7}},{"generated":{"line":174,"column":23},"source":"lib.js","original":{"line":175,"column":0}},{"name":"clearModelMemory","generated":{"line":174,"column":26},"source":"lib.js","original":{"line":175,"column":26}},{"generated":{"line":174,"column":42},"source":"lib.js","original":{"line":175,"column":0}},{"name":"window","generated":{"line":175,"column":0},"source":"lib.js","original":{"line":176,"column":0}},{"generated":{"line":175,"column":6},"source":"lib.js","original":{"line":176,"column":6}},{"name":"predict","generated":{"line":175,"column":7},"source":"lib.js","original":{"line":176,"column":7}},{"generated":{"line":175,"column":14},"source":"lib.js","original":{"line":176,"column":0}},{"name":"predict","generated":{"line":175,"column":17},"source":"lib.js","original":{"line":176,"column":17}},{"generated":{"line":175,"column":24},"source":"lib.js","original":{"line":176,"column":0}},{"name":"window","generated":{"line":176,"column":0},"source":"lib.js","original":{"line":177,"column":0}},{"generated":{"line":176,"column":6},"source":"lib.js","original":{"line":177,"column":6}},{"name":"resizeImage","generated":{"line":176,"column":7},"source":"lib.js","original":{"line":177,"column":7}},{"generated":{"line":176,"column":18},"source":"lib.js","original":{"line":177,"column":0}},{"name":"resizeImage","generated":{"line":176,"column":21},"source":"lib.js","original":{"line":177,"column":21}},{"generated":{"line":176,"column":32},"source":"lib.js","original":{"line":177,"column":0}}],"sources":{"lib.js":"import * as tf from '@tensorflow/tfjs';\n// import * as tfjsWasm from '@tensorflow/tfjs-backend-wasm';\n// import * as cam from './cam';\n// import jimp from 'jimp';\n\nconst MODEL_PATH = './model/model.json';\n// const MODEL_PATH = 'https://firebasestorage.googleapis.com/v0/b/catch-of-the-day-45cb7.appspot.com/o/model%2Fmodel.json?alt=media';\n\nexport const IMAGE_SIZE = 256;\n\nlet model;\nexport const loadModel = async () => {\n  // await tf.setBackend('wasm');\n  console.log('loading model....');\n  model = await tf.loadLayersModel(MODEL_PATH, {});\n\n  // Warmup the model. This isn't necessary, but makes the first prediction\n  // faster. Call `dispose` to release the WebGL memory allocated for the return\n  // value of `predict`.\n  // model.predict(tf.zeros([1, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n\n  // Show model layers and summary\n  model.summary();\n};\n\nexport const clearModelMemory = () => {\n  model.predict(tf.zeros([null, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n};\n\n/**\n * Given an image element, makes a prediction through model returning the\n * probabilities of the top K classes.\n */\nexport async function predict(imgElement) {\n  // The first start time includes the time it takes to extract the image\n  // from the HTML and preprocess it, in additon to the predict() call.\n  const startTime1 = performance.now();\n  // The second start time excludes the extraction and preprocessing and\n  // includes only the predict() call.\n  let startTime2;\n  const logits = tf.tidy(() => {\n    // tf.browser.fromPixels() returns a Tensor from an image element.\n    // const img = tf.browser.fromPixels(imgElement, 1);\n\n    // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n    const normalizationConstant = 1.0 / 255.0;\n    // const normalized = img.toFloat().mul(normalizationConstant);\n\n    let img = tf.browser.fromPixels(imgElement, 3)\n      .resizeBilinear([IMAGE_SIZE, IMAGE_SIZE], false)\n      .expandDims(0)\n      .pad([[1, 1]])\n      .toFloat()\n      .mul(normalizationConstant);\n\n    // const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n\n    // Reshape to a single-element batch so we can pass it to predict.\n    // const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n    startTime2 = performance.now();\n\n    // Make a prediction through model.\n    return model.predict(img);\n  });\n\n  // Convert logits to probabilities and class names.\n  const classes = await logits.data();\n\n  console.log('Predictions: ', classes);\n  const labelName = classes[0] < 0.5? 'NORMAL' : 'PNEUMONIA';\n  const probability = classes[0];\n\n  const totalTime1 = performance.now() - startTime1;\n  const totalTime2 = performance.now() - startTime2;\n  console.log(`Done in ${Math.floor(totalTime1)} ms ` +\n      `(not including preprocessing: ${Math.floor(totalTime2)} ms)`);\n\n  // Return the best probability label\n  return `${labelName} (${Math.floor(probability * 100)}%)`;\n}\n\nexport function resizeImage(imgElement) {\n  const canvas = document.createElement('canvas');\n  canvas.height=IMAGE_SIZE;\n  canvas.width=IMAGE_SIZE;\n\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas\n  ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);\n\n  const img = document.createElement('img');\n  img.src = canvas.toDataURL('image/jpeg'); ;\n  img.width = IMAGE_SIZE;\n  img.height = IMAGE_SIZE;\n\n  return img;\n}\n\n/* export async function gradCamOverlay(imgElement, canvas){\n  // tf.browser.fromPixels() returns a Tensor from an image element.\n  const img = tf.browser.fromPixels(imgElement, 1);\n\n  // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n  const normalizationConstant = 1.0 / 255.0;\n  const normalized = img.toFloat().mul(normalizationConstant);\n\n  const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n  // Reshape to a single-element batch so we can pass it to predict.\n  const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n  // Calculate Grad-CAM heatmap.\n  const xWithCAMOverlay = cam.gradClassActivationMap(model, 1, batched);\n\n  // const imageH = xWithCAMOverlay.shape[1];\n  // const imageW = xWithCAMOverlay.shape[2];\n  // let imageData = xWithCAMOverlay.dataSync();\n\n  const ctx = canvas.getContext('2d');\n  //get the tensor shape\n  const [height, width] = xWithCAMOverlay.shape;\n  //create a buffer array\n  const buffer = new Uint8Array(width * height * 4)\n  //create an Image data var\n  const imageData = new ImageData(width, height);\n  //get the tensor values as data\n  const data = xWithCAMOverlay.dataSync();\n\n  //map the values to the buffer\n  var i = 0;\n  for(var y = 0; y < height; y++) {\n    for(var x = 0; x < width; x++) {\n      var pos = (y * width + x) * 4;      // position in buffer based on x and y\n      buffer[pos  ] = data[i]             // some R value [0, 255]\n      buffer[pos+1] = data[i+1]           // some G value\n      buffer[pos+2] = data[i+2]           // some B value\n      buffer[pos+3] = 255;                // set alpha channel\n      i+=3\n    }\n  }\n\n  let index = 0;\n  for (let i = 0; i < height; ++i) {\n    for (let j = 0; j < width; ++j) {\n      const inIndex = 3 * (i * height + j);\n      buffer.set([Math.floor(data[inIndex])], index++);\n      buffer.set([Math.floor(data[inIndex + 1])], index++);\n      buffer.set([Math.floor(data[inIndex + 2])], index++);\n      buffer.set([255], index++);\n    }\n  }\n\n  //set the buffer to the image data\n  imageData.data.set(buffer)\n\n  //show the image on canvas\n  ctx.putImageData(imageData, 0, 0);\n\n  const imageEl = new Image();\n  imageEl.onload = function() {\n    ctx.drawImage(image, 0, 0);\n  };\n\n  new jimp({data: new Buffer(buffer), width: width, height: height}, function (err, image) {\n    image.getBase64(jimp.AUTO, function(err, data) {  // Add err\n      console.log(data);\n      imageEl.src = data;\n    });\n  });\n\n  // return tf.browser.toPixels(imageData);\n}*/\n\nwindow.loadModel = loadModel;\nwindow.clearModelMemory = clearModelMemory;\nwindow.predict = predict;\nwindow.resizeImage = resizeImage;\n"},"lineCount":null}},"error":null,"hash":"9c2a9522cfc199ea9a3036816675e451","cacheData":{"env":{}}}