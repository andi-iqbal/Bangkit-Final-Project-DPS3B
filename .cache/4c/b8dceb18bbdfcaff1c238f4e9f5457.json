{"id":"oHGM","dependencies":[{"name":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/.babelrc","includedInParent":true,"mtime":1592144127903},{"name":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/package.json","includedInParent":true,"mtime":1592145407351},{"name":"@tensorflow/tfjs","loc":{"line":1,"column":20},"parent":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/lib.js","resolved":"/Users/hasanmubarok/Research/machine_learning/Bangkit-Final-Project/node_modules/@tensorflow/tfjs/dist/index.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.predict=l,exports.resizeImage=s,exports.clearModelMemory=exports.loadModel=exports.IMAGE_SIZE=void 0;var e=t(require(\"@tensorflow/tfjs\"));function o(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function t(e){if(e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}return r.default=e,t&&t.set(e,r),r}const r=\"./model/model.json\",n=256;let a;exports.IMAGE_SIZE=n;const i=async()=>{console.log(\"loading model....\"),(a=await e.loadLayersModel(r,{})).summary()};exports.loadModel=i;const c=()=>{a.predict(e.zeros([null,n,n,3])).dispose()};async function l(o){const t=performance.now();let r;const i=e.tidy(()=>{let t=e.browser.fromPixels(o,3).resizeBilinear([n,n],!1).expandDims(0).pad([[1,1]]).toFloat().mul(1/255);return r=performance.now(),a.predict(t)}),c=await i.data();console.log(\"Predictions: \",c);const l=c[0]<.5?\"NORMAL\":\"PNEUMONIA\",s=c[0],d=performance.now()-t,p=performance.now()-r;return console.log(`Done in ${Math.floor(d)} ms `+`(not including preprocessing: ${Math.floor(p)} ms)`),`${l} (${Math.floor(100*s)}%)`}function s(e){const o=document.createElement(\"canvas\");o.height=n,o.width=n;const t=o.getContext(\"2d\");t.clearRect(0,0,o.width,o.height),t.drawImage(e,0,0,o.width,o.height);const r=document.createElement(\"img\");return r.src=o.toDataURL(\"image/jpeg\"),r.width=n,r.height=n,r}exports.clearModelMemory=c,window.loadModel=i,window.clearModelMemory=c,window.predict=l,window.resizeImage=s;"},"sourceMaps":{"js":{"mappings":[{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":0}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":13}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":20}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":35}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":43}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":56}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":57}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":64}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":68}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":76}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":84}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":86}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":94}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":106}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":108}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":116}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":133}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":141}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":151}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":159}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":175}},{"source":"lib.js","original":{"line":1,"column":0},"generated":{"line":1,"column":177}},{"source":"lib.js","original":{"line":1,"column":0},"generated":{"line":1,"column":181}},{"source":"lib.js","original":{"line":1,"column":0},"generated":{"line":1,"column":183}},{"source":"lib.js","original":{"line":1,"column":0},"generated":{"line":1,"column":185}},{"source":"lib.js","original":{"line":1,"column":0},"generated":{"line":1,"column":193}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":214}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":223}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":227}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":230}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":249}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":257}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":264}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":269}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":273}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":275}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":279}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":287}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":294}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":296}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":307}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":314}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":317}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":319}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":328}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":330}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":333}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":336}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":339}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":341}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":352}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":359}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":361}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":364}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":371}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":374}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":391}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":394}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":413}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":415}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":421}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":422}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":430}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":433}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":437}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":439}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":443}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":446}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":449}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":451}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":455}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":458}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":465}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":467}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":471}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":474}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":478}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":480}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":483}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":485}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":492}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":508}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":515}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":540}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":544}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":548}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":553}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":555}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":558}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":565}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":575}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":590}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":595}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":597}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":600}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":601}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":605}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":607}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":609}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":616}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":641}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":643}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":646}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":651}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":655}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":657}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":662}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":664}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":669}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":676}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":691}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":693}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":695}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":698}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":700}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":703}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":705}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":708}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":715}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":717}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":725}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":727}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":730}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":732}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":736}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":738}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":741}},{"source":"lib.js","original":{"line":6,"column":0},"generated":{"line":1,"column":743}},{"source":"lib.js","name":"MODEL_PATH","original":{"line":6,"column":6},"generated":{"line":1,"column":749}},{"source":"lib.js","original":{"line":6,"column":19},"generated":{"line":1,"column":751}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":9,"column":13},"generated":{"line":1,"column":772}},{"source":"lib.js","original":{"line":9,"column":26},"generated":{"line":1,"column":774}},{"source":"lib.js","original":{"line":11,"column":0},"generated":{"line":1,"column":778}},{"source":"lib.js","name":"model","original":{"line":11,"column":4},"generated":{"line":1,"column":782}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":784}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":792}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":803}},{"source":"lib.js","original":{"line":12,"column":7},"generated":{"line":1,"column":805}},{"source":"lib.js","name":"loadModel","original":{"line":12,"column":13},"generated":{"line":1,"column":811}},{"source":"lib.js","original":{"line":12,"column":25},"generated":{"line":1,"column":813}},{"source":"lib.js","name":"console","original":{"line":14,"column":2},"generated":{"line":1,"column":823}},{"source":"lib.js","name":"log","original":{"line":14,"column":10},"generated":{"line":1,"column":831}},{"source":"lib.js","original":{"line":14,"column":14},"generated":{"line":1,"column":835}},{"source":"lib.js","name":"model","original":{"line":15,"column":2},"generated":{"line":1,"column":857}},{"source":"lib.js","name":"tf","original":{"line":15,"column":16},"generated":{"line":1,"column":865}},{"source":"lib.js","name":"loadLayersModel","original":{"line":15,"column":19},"generated":{"line":1,"column":867}},{"source":"lib.js","name":"MODEL_PATH","original":{"line":15,"column":35},"generated":{"line":1,"column":883}},{"source":"lib.js","original":{"line":15,"column":47},"generated":{"line":1,"column":885}},{"source":"lib.js","name":"summary","original":{"line":23,"column":8},"generated":{"line":1,"column":890}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":901}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":909}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":919}},{"source":"lib.js","original":{"line":26,"column":7},"generated":{"line":1,"column":921}},{"source":"lib.js","name":"clearModelMemory","original":{"line":26,"column":13},"generated":{"line":1,"column":927}},{"source":"lib.js","original":{"line":26,"column":32},"generated":{"line":1,"column":929}},{"source":"lib.js","name":"model","original":{"line":27,"column":2},"generated":{"line":1,"column":934}},{"source":"lib.js","name":"predict","original":{"line":27,"column":8},"generated":{"line":1,"column":936}},{"source":"lib.js","name":"tf","original":{"line":27,"column":16},"generated":{"line":1,"column":944}},{"source":"lib.js","name":"zeros","original":{"line":27,"column":19},"generated":{"line":1,"column":946}},{"source":"lib.js","original":{"line":27,"column":25},"generated":{"line":1,"column":952}},{"source":"lib.js","original":{"line":27,"column":26},"generated":{"line":1,"column":953}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":27,"column":32},"generated":{"line":1,"column":958}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":27,"column":44},"generated":{"line":1,"column":960}},{"source":"lib.js","original":{"line":27,"column":56},"generated":{"line":1,"column":962}},{"source":"lib.js","name":"dispose","original":{"line":27,"column":61},"generated":{"line":1,"column":967}},{"source":"lib.js","original":{"line":34,"column":7},"generated":{"line":1,"column":978}},{"source":"lib.js","name":"predict","original":{"line":34,"column":22},"generated":{"line":1,"column":993}},{"source":"lib.js","name":"imgElement","original":{"line":34,"column":30},"generated":{"line":1,"column":995}},{"source":"lib.js","name":"startTime1","original":{"line":37,"column":8},"generated":{"line":1,"column":998}},{"source":"lib.js","name":"startTime1","original":{"line":37,"column":8},"generated":{"line":1,"column":1004}},{"source":"lib.js","name":"performance","original":{"line":37,"column":21},"generated":{"line":1,"column":1006}},{"source":"lib.js","name":"now","original":{"line":37,"column":33},"generated":{"line":1,"column":1018}},{"source":"lib.js","name":"startTime2","original":{"line":40,"column":6},"generated":{"line":1,"column":1024}},{"source":"lib.js","name":"startTime2","original":{"line":40,"column":6},"generated":{"line":1,"column":1028}},{"source":"lib.js","name":"logits","original":{"line":41,"column":8},"generated":{"line":1,"column":1030}},{"source":"lib.js","name":"logits","original":{"line":41,"column":8},"generated":{"line":1,"column":1036}},{"source":"lib.js","name":"tf","original":{"line":41,"column":17},"generated":{"line":1,"column":1038}},{"source":"lib.js","name":"tidy","original":{"line":41,"column":20},"generated":{"line":1,"column":1040}},{"source":"lib.js","original":{"line":41,"column":25},"generated":{"line":1,"column":1045}},{"source":"lib.js","name":"img","original":{"line":49,"column":8},"generated":{"line":1,"column":1050}},{"source":"lib.js","name":"img","original":{"line":49,"column":8},"generated":{"line":1,"column":1054}},{"source":"lib.js","name":"tf","original":{"line":49,"column":14},"generated":{"line":1,"column":1056}},{"source":"lib.js","name":"browser","original":{"line":49,"column":17},"generated":{"line":1,"column":1058}},{"source":"lib.js","name":"fromPixels","original":{"line":49,"column":25},"generated":{"line":1,"column":1066}},{"source":"lib.js","name":"imgElement","original":{"line":49,"column":36},"generated":{"line":1,"column":1077}},{"source":"lib.js","original":{"line":49,"column":48},"generated":{"line":1,"column":1079}},{"source":"lib.js","name":"resizeBilinear","original":{"line":50,"column":7},"generated":{"line":1,"column":1082}},{"source":"lib.js","original":{"line":50,"column":22},"generated":{"line":1,"column":1097}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":50,"column":23},"generated":{"line":1,"column":1098}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":50,"column":35},"generated":{"line":1,"column":1100}},{"source":"lib.js","original":{"line":50,"column":48},"generated":{"line":1,"column":1104}},{"source":"lib.js","name":"expandDims","original":{"line":51,"column":7},"generated":{"line":1,"column":1107}},{"source":"lib.js","original":{"line":51,"column":18},"generated":{"line":1,"column":1118}},{"source":"lib.js","name":"pad","original":{"line":52,"column":7},"generated":{"line":1,"column":1121}},{"source":"lib.js","original":{"line":52,"column":11},"generated":{"line":1,"column":1125}},{"source":"lib.js","original":{"line":52,"column":12},"generated":{"line":1,"column":1126}},{"source":"lib.js","original":{"line":52,"column":13},"generated":{"line":1,"column":1127}},{"source":"lib.js","original":{"line":52,"column":16},"generated":{"line":1,"column":1129}},{"source":"lib.js","name":"toFloat","original":{"line":53,"column":7},"generated":{"line":1,"column":1134}},{"source":"lib.js","name":"mul","original":{"line":54,"column":7},"generated":{"line":1,"column":1144}},{"source":"lib.js","original":{"line":46,"column":34},"generated":{"line":1,"column":1148}},{"source":"lib.js","original":{"line":46,"column":40},"generated":{"line":1,"column":1150}},{"source":"lib.js","name":"model","original":{"line":64,"column":11},"generated":{"line":1,"column":1155}},{"source":"lib.js","name":"startTime2","original":{"line":61,"column":4},"generated":{"line":1,"column":1162}},{"source":"lib.js","name":"performance","original":{"line":61,"column":17},"generated":{"line":1,"column":1164}},{"source":"lib.js","name":"now","original":{"line":61,"column":29},"generated":{"line":1,"column":1176}},{"source":"lib.js","name":"model","original":{"line":64,"column":11},"generated":{"line":1,"column":1182}},{"source":"lib.js","name":"predict","original":{"line":64,"column":17},"generated":{"line":1,"column":1184}},{"source":"lib.js","name":"img","original":{"line":64,"column":25},"generated":{"line":1,"column":1192}},{"source":"lib.js","name":"classes","original":{"line":68,"column":8},"generated":{"line":1,"column":1197}},{"source":"lib.js","name":"logits","original":{"line":68,"column":24},"generated":{"line":1,"column":1205}},{"source":"lib.js","name":"data","original":{"line":68,"column":31},"generated":{"line":1,"column":1207}},{"source":"lib.js","name":"console","original":{"line":70,"column":2},"generated":{"line":1,"column":1214}},{"source":"lib.js","name":"log","original":{"line":70,"column":10},"generated":{"line":1,"column":1222}},{"source":"lib.js","original":{"line":70,"column":14},"generated":{"line":1,"column":1226}},{"source":"lib.js","name":"classes","original":{"line":70,"column":31},"generated":{"line":1,"column":1242}},{"source":"lib.js","name":"labelName","original":{"line":71,"column":8},"generated":{"line":1,"column":1245}},{"source":"lib.js","name":"labelName","original":{"line":71,"column":8},"generated":{"line":1,"column":1251}},{"source":"lib.js","name":"classes","original":{"line":71,"column":20},"generated":{"line":1,"column":1253}},{"source":"lib.js","original":{"line":71,"column":28},"generated":{"line":1,"column":1255}},{"source":"lib.js","original":{"line":71,"column":33},"generated":{"line":1,"column":1258}},{"source":"lib.js","original":{"line":71,"column":38},"generated":{"line":1,"column":1261}},{"source":"lib.js","original":{"line":71,"column":49},"generated":{"line":1,"column":1270}},{"source":"lib.js","name":"probability","original":{"line":72,"column":8},"generated":{"line":1,"column":1282}},{"source":"lib.js","name":"classes","original":{"line":72,"column":22},"generated":{"line":1,"column":1284}},{"source":"lib.js","original":{"line":72,"column":30},"generated":{"line":1,"column":1286}},{"source":"lib.js","name":"totalTime1","original":{"line":74,"column":8},"generated":{"line":1,"column":1289}},{"source":"lib.js","name":"performance","original":{"line":74,"column":21},"generated":{"line":1,"column":1291}},{"source":"lib.js","name":"now","original":{"line":74,"column":33},"generated":{"line":1,"column":1303}},{"source":"lib.js","name":"startTime1","original":{"line":74,"column":41},"generated":{"line":1,"column":1309}},{"source":"lib.js","name":"totalTime2","original":{"line":75,"column":8},"generated":{"line":1,"column":1311}},{"source":"lib.js","name":"performance","original":{"line":75,"column":21},"generated":{"line":1,"column":1313}},{"source":"lib.js","name":"now","original":{"line":75,"column":33},"generated":{"line":1,"column":1325}},{"source":"lib.js","name":"startTime2","original":{"line":75,"column":41},"generated":{"line":1,"column":1331}},{"source":"lib.js","original":{"line":80,"column":10},"generated":{"line":1,"column":1333}},{"source":"lib.js","name":"console","original":{"line":76,"column":2},"generated":{"line":1,"column":1340}},{"source":"lib.js","name":"log","original":{"line":76,"column":10},"generated":{"line":1,"column":1348}},{"source":"lib.js","name":"Math","original":{"line":76,"column":25},"generated":{"line":1,"column":1363}},{"source":"lib.js","name":"floor","original":{"line":76,"column":30},"generated":{"line":1,"column":1368}},{"source":"lib.js","name":"totalTime1","original":{"line":76,"column":36},"generated":{"line":1,"column":1374}},{"source":"lib.js","name":"Math","original":{"line":77,"column":39},"generated":{"line":1,"column":1416}},{"source":"lib.js","name":"floor","original":{"line":77,"column":44},"generated":{"line":1,"column":1421}},{"source":"lib.js","name":"totalTime2","original":{"line":77,"column":50},"generated":{"line":1,"column":1427}},{"source":"lib.js","name":"labelName","original":{"line":80,"column":12},"generated":{"line":1,"column":1440}},{"source":"lib.js","name":"Math","original":{"line":80,"column":26},"generated":{"line":1,"column":1446}},{"source":"lib.js","name":"floor","original":{"line":80,"column":31},"generated":{"line":1,"column":1451}},{"source":"lib.js","original":{"line":80,"column":51},"generated":{"line":1,"column":1457}},{"source":"lib.js","name":"probability","original":{"line":80,"column":37},"generated":{"line":1,"column":1461}},{"source":"lib.js","original":{"line":83,"column":7},"generated":{"line":1,"column":1468}},{"source":"lib.js","name":"resizeImage","original":{"line":83,"column":16},"generated":{"line":1,"column":1477}},{"source":"lib.js","name":"imgElement","original":{"line":83,"column":28},"generated":{"line":1,"column":1479}},{"source":"lib.js","name":"canvas","original":{"line":84,"column":8},"generated":{"line":1,"column":1482}},{"source":"lib.js","name":"canvas","original":{"line":84,"column":8},"generated":{"line":1,"column":1488}},{"source":"lib.js","name":"document","original":{"line":84,"column":17},"generated":{"line":1,"column":1490}},{"source":"lib.js","name":"createElement","original":{"line":84,"column":26},"generated":{"line":1,"column":1499}},{"source":"lib.js","original":{"line":84,"column":40},"generated":{"line":1,"column":1513}},{"source":"lib.js","name":"canvas","original":{"line":85,"column":2},"generated":{"line":1,"column":1523}},{"source":"lib.js","name":"height","original":{"line":85,"column":9},"generated":{"line":1,"column":1525}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":85,"column":16},"generated":{"line":1,"column":1532}},{"source":"lib.js","name":"canvas","original":{"line":86,"column":2},"generated":{"line":1,"column":1534}},{"source":"lib.js","name":"width","original":{"line":86,"column":9},"generated":{"line":1,"column":1536}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":86,"column":15},"generated":{"line":1,"column":1542}},{"source":"lib.js","name":"ctx","original":{"line":88,"column":8},"generated":{"line":1,"column":1544}},{"source":"lib.js","name":"ctx","original":{"line":88,"column":8},"generated":{"line":1,"column":1550}},{"source":"lib.js","name":"canvas","original":{"line":88,"column":14},"generated":{"line":1,"column":1552}},{"source":"lib.js","name":"getContext","original":{"line":88,"column":21},"generated":{"line":1,"column":1554}},{"source":"lib.js","original":{"line":88,"column":32},"generated":{"line":1,"column":1565}},{"source":"lib.js","name":"ctx","original":{"line":89,"column":2},"generated":{"line":1,"column":1571}},{"source":"lib.js","name":"clearRect","original":{"line":89,"column":6},"generated":{"line":1,"column":1573}},{"source":"lib.js","original":{"line":89,"column":16},"generated":{"line":1,"column":1583}},{"source":"lib.js","original":{"line":89,"column":19},"generated":{"line":1,"column":1585}},{"source":"lib.js","name":"canvas","original":{"line":89,"column":22},"generated":{"line":1,"column":1587}},{"source":"lib.js","name":"width","original":{"line":89,"column":29},"generated":{"line":1,"column":1589}},{"source":"lib.js","name":"canvas","original":{"line":89,"column":36},"generated":{"line":1,"column":1595}},{"source":"lib.js","name":"height","original":{"line":89,"column":43},"generated":{"line":1,"column":1597}},{"source":"lib.js","name":"ctx","original":{"line":90,"column":2},"generated":{"line":1,"column":1605}},{"source":"lib.js","name":"drawImage","original":{"line":90,"column":6},"generated":{"line":1,"column":1607}},{"source":"lib.js","name":"imgElement","original":{"line":90,"column":16},"generated":{"line":1,"column":1617}},{"source":"lib.js","original":{"line":90,"column":28},"generated":{"line":1,"column":1619}},{"source":"lib.js","original":{"line":90,"column":31},"generated":{"line":1,"column":1621}},{"source":"lib.js","name":"canvas","original":{"line":90,"column":34},"generated":{"line":1,"column":1623}},{"source":"lib.js","name":"width","original":{"line":90,"column":41},"generated":{"line":1,"column":1625}},{"source":"lib.js","name":"canvas","original":{"line":90,"column":48},"generated":{"line":1,"column":1631}},{"source":"lib.js","name":"height","original":{"line":90,"column":55},"generated":{"line":1,"column":1633}},{"source":"lib.js","name":"img","original":{"line":92,"column":8},"generated":{"line":1,"column":1641}},{"source":"lib.js","name":"img","original":{"line":92,"column":8},"generated":{"line":1,"column":1647}},{"source":"lib.js","name":"document","original":{"line":92,"column":14},"generated":{"line":1,"column":1649}},{"source":"lib.js","name":"createElement","original":{"line":92,"column":23},"generated":{"line":1,"column":1658}},{"source":"lib.js","original":{"line":92,"column":37},"generated":{"line":1,"column":1672}},{"source":"lib.js","name":"img","original":{"line":97,"column":9},"generated":{"line":1,"column":1679}},{"source":"lib.js","name":"img","original":{"line":93,"column":2},"generated":{"line":1,"column":1686}},{"source":"lib.js","name":"src","original":{"line":93,"column":6},"generated":{"line":1,"column":1688}},{"source":"lib.js","name":"canvas","original":{"line":93,"column":12},"generated":{"line":1,"column":1692}},{"source":"lib.js","name":"toDataURL","original":{"line":93,"column":19},"generated":{"line":1,"column":1694}},{"source":"lib.js","original":{"line":93,"column":29},"generated":{"line":1,"column":1704}},{"source":"lib.js","name":"img","original":{"line":94,"column":2},"generated":{"line":1,"column":1718}},{"source":"lib.js","name":"width","original":{"line":94,"column":6},"generated":{"line":1,"column":1720}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":94,"column":14},"generated":{"line":1,"column":1726}},{"source":"lib.js","name":"img","original":{"line":95,"column":2},"generated":{"line":1,"column":1728}},{"source":"lib.js","name":"height","original":{"line":95,"column":6},"generated":{"line":1,"column":1730}},{"source":"lib.js","name":"IMAGE_SIZE","original":{"line":95,"column":15},"generated":{"line":1,"column":1737}},{"source":"lib.js","name":"img","original":{"line":97,"column":9},"generated":{"line":1,"column":1739}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":1741}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":1749}},{"source":"lib.js","original":{"line":177,"column":0},"generated":{"line":1,"column":1766}},{"source":"lib.js","name":"window","original":{"line":174,"column":0},"generated":{"line":1,"column":1768}},{"source":"lib.js","name":"loadModel","original":{"line":174,"column":7},"generated":{"line":1,"column":1775}},{"source":"lib.js","name":"loadModel","original":{"line":174,"column":19},"generated":{"line":1,"column":1785}},{"source":"lib.js","name":"window","original":{"line":175,"column":0},"generated":{"line":1,"column":1787}},{"source":"lib.js","name":"clearModelMemory","original":{"line":175,"column":7},"generated":{"line":1,"column":1794}},{"source":"lib.js","name":"clearModelMemory","original":{"line":175,"column":26},"generated":{"line":1,"column":1811}},{"source":"lib.js","name":"window","original":{"line":176,"column":0},"generated":{"line":1,"column":1813}},{"source":"lib.js","name":"predict","original":{"line":176,"column":7},"generated":{"line":1,"column":1820}},{"source":"lib.js","name":"predict","original":{"line":176,"column":17},"generated":{"line":1,"column":1828}},{"source":"lib.js","name":"window","original":{"line":177,"column":0},"generated":{"line":1,"column":1830}},{"source":"lib.js","name":"resizeImage","original":{"line":177,"column":7},"generated":{"line":1,"column":1837}},{"source":"lib.js","name":"resizeImage","original":{"line":177,"column":21},"generated":{"line":1,"column":1849}}],"sources":{"lib.js":"import * as tf from '@tensorflow/tfjs';\n// import * as tfjsWasm from '@tensorflow/tfjs-backend-wasm';\n// import * as cam from './cam';\n// import jimp from 'jimp';\n\nconst MODEL_PATH = './model/model.json';\n// const MODEL_PATH = 'https://firebasestorage.googleapis.com/v0/b/catch-of-the-day-45cb7.appspot.com/o/model%2Fmodel.json?alt=media';\n\nexport const IMAGE_SIZE = 256;\n\nlet model;\nexport const loadModel = async () => {\n  // await tf.setBackend('wasm');\n  console.log('loading model....');\n  model = await tf.loadLayersModel(MODEL_PATH, {});\n\n  // Warmup the model. This isn't necessary, but makes the first prediction\n  // faster. Call `dispose` to release the WebGL memory allocated for the return\n  // value of `predict`.\n  // model.predict(tf.zeros([1, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n\n  // Show model layers and summary\n  model.summary();\n};\n\nexport const clearModelMemory = () => {\n  model.predict(tf.zeros([null, IMAGE_SIZE, IMAGE_SIZE, 3])).dispose();\n};\n\n/**\n * Given an image element, makes a prediction through model returning the\n * probabilities of the top K classes.\n */\nexport async function predict(imgElement) {\n  // The first start time includes the time it takes to extract the image\n  // from the HTML and preprocess it, in additon to the predict() call.\n  const startTime1 = performance.now();\n  // The second start time excludes the extraction and preprocessing and\n  // includes only the predict() call.\n  let startTime2;\n  const logits = tf.tidy(() => {\n    // tf.browser.fromPixels() returns a Tensor from an image element.\n    // const img = tf.browser.fromPixels(imgElement, 1);\n\n    // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n    const normalizationConstant = 1.0 / 255.0;\n    // const normalized = img.toFloat().mul(normalizationConstant);\n\n    let img = tf.browser.fromPixels(imgElement, 3)\n      .resizeBilinear([IMAGE_SIZE, IMAGE_SIZE], false)\n      .expandDims(0)\n      .pad([[1, 1]])\n      .toFloat()\n      .mul(normalizationConstant);\n\n    // const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n\n    // Reshape to a single-element batch so we can pass it to predict.\n    // const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n    startTime2 = performance.now();\n\n    // Make a prediction through model.\n    return model.predict(img);\n  });\n\n  // Convert logits to probabilities and class names.\n  const classes = await logits.data();\n\n  console.log('Predictions: ', classes);\n  const labelName = classes[0] < 0.5? 'NORMAL' : 'PNEUMONIA';\n  const probability = classes[0];\n\n  const totalTime1 = performance.now() - startTime1;\n  const totalTime2 = performance.now() - startTime2;\n  console.log(`Done in ${Math.floor(totalTime1)} ms ` +\n      `(not including preprocessing: ${Math.floor(totalTime2)} ms)`);\n\n  // Return the best probability label\n  return `${labelName} (${Math.floor(probability * 100)}%)`;\n}\n\nexport function resizeImage(imgElement) {\n  const canvas = document.createElement('canvas');\n  canvas.height=IMAGE_SIZE;\n  canvas.width=IMAGE_SIZE;\n\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas\n  ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);\n\n  const img = document.createElement('img');\n  img.src = canvas.toDataURL('image/jpeg'); ;\n  img.width = IMAGE_SIZE;\n  img.height = IMAGE_SIZE;\n\n  return img;\n}\n\n/* export async function gradCamOverlay(imgElement, canvas){\n  // tf.browser.fromPixels() returns a Tensor from an image element.\n  const img = tf.browser.fromPixels(imgElement, 1);\n\n  // Normalize the image from [0, 225] to [INPUT_MIN, INPUT_MAX]\n  const normalizationConstant = 1.0 / 255.0;\n  const normalized = img.toFloat().mul(normalizationConstant);\n\n  const image = tf.image.resizeBilinear(normalized, [IMAGE_SIZE, IMAGE_SIZE], false);\n  // Reshape to a single-element batch so we can pass it to predict.\n  const batched = image.reshape([-1, IMAGE_SIZE, IMAGE_SIZE, 1]);\n\n  // Calculate Grad-CAM heatmap.\n  const xWithCAMOverlay = cam.gradClassActivationMap(model, 1, batched);\n\n  // const imageH = xWithCAMOverlay.shape[1];\n  // const imageW = xWithCAMOverlay.shape[2];\n  // let imageData = xWithCAMOverlay.dataSync();\n\n  const ctx = canvas.getContext('2d');\n  //get the tensor shape\n  const [height, width] = xWithCAMOverlay.shape;\n  //create a buffer array\n  const buffer = new Uint8Array(width * height * 4)\n  //create an Image data var\n  const imageData = new ImageData(width, height);\n  //get the tensor values as data\n  const data = xWithCAMOverlay.dataSync();\n\n  //map the values to the buffer\n  var i = 0;\n  for(var y = 0; y < height; y++) {\n    for(var x = 0; x < width; x++) {\n      var pos = (y * width + x) * 4;      // position in buffer based on x and y\n      buffer[pos  ] = data[i]             // some R value [0, 255]\n      buffer[pos+1] = data[i+1]           // some G value\n      buffer[pos+2] = data[i+2]           // some B value\n      buffer[pos+3] = 255;                // set alpha channel\n      i+=3\n    }\n  }\n\n  let index = 0;\n  for (let i = 0; i < height; ++i) {\n    for (let j = 0; j < width; ++j) {\n      const inIndex = 3 * (i * height + j);\n      buffer.set([Math.floor(data[inIndex])], index++);\n      buffer.set([Math.floor(data[inIndex + 1])], index++);\n      buffer.set([Math.floor(data[inIndex + 2])], index++);\n      buffer.set([255], index++);\n    }\n  }\n\n  //set the buffer to the image data\n  imageData.data.set(buffer)\n\n  //show the image on canvas\n  ctx.putImageData(imageData, 0, 0);\n\n  const imageEl = new Image();\n  imageEl.onload = function() {\n    ctx.drawImage(image, 0, 0);\n  };\n\n  new jimp({data: new Buffer(buffer), width: width, height: height}, function (err, image) {\n    image.getBase64(jimp.AUTO, function(err, data) {  // Add err\n      console.log(data);\n      imageEl.src = data;\n    });\n  });\n\n  // return tf.browser.toPixels(imageData);\n}*/\n\nwindow.loadModel = loadModel;\nwindow.clearModelMemory = clearModelMemory;\nwindow.predict = predict;\nwindow.resizeImage = resizeImage;\n"},"lineCount":null}},"error":null,"hash":"5b45c250d86ce8c91621cdcc3f17948c","cacheData":{"env":{}}}